# インデックス vs パーティション 比較レポート

## テスト条件

- レコード数: **10,000,000件**
- テーブル構成:

| テーブル | データサイズ | インデックス | パーティション |
|---------|-------------|--------------|---------------|
| books_bare | 744MB | なし | なし |
| books | - | あり (author_id, created_at) | なし |
| books_part_no_idx | 726MB | なし | RANGE(year) 7分割 |
| books_part_with_idx | 696MB + 691MB idx | あり | RANGE(year) 7分割 |

---

## 1. 日付範囲検索（1ヶ月: 158,900件）

| 構成 | 時間 | ベースライン比 |
|------|------|---------------|
| インデックスなし・パーティションなし | **15.2秒** | baseline |
| **インデックスあり**・パーティションなし | **28ms** | **99.8% 高速** |
| インデックスなし・**パーティションあり** | **957ms** | 93.7% 高速 |
| **インデックス + パーティション** | **34ms** | **99.8% 高速** |

### 分析
- インデックスの効果が圧倒的（15.2秒 → 28ms）
- パーティションのみでも大幅改善（15.2秒 → 957ms）
- インデックス + パーティションはインデックスのみとほぼ同等

---

## 2. 日付範囲検索（1年: 1,994,920件）

| 構成 | 時間 | ベースライン比 |
|------|------|---------------|
| インデックスなし・パーティションなし | **4.2秒** | baseline |
| **インデックスあり**・パーティションなし | **403ms** | 90.5% 高速 |
| インデックスなし・**パーティションあり** | **709ms** | 83.2% 高速 |
| **インデックス + パーティション** | **334ms** | **92.1% 高速** |

### 分析
- 大量データ取得時はパーティションの効果が高まる
- インデックス + パーティションが最速

---

## 3. 外部キー検索（単一著者）

| 構成 | 時間 | ベースライン比 |
|------|------|---------------|
| インデックスなし・パーティションなし | **1.93秒** | baseline |
| **インデックスあり**・パーティションなし | **1.1ms** | **99.94% 高速** |
| インデックスなし・パーティションあり (author_id) | **7.5ms** | 99.6% 高速 |
| **インデックス + パーティション** | **0.2ms** | **99.99% 高速** |

### 分析
- インデックスが最も重要
- パーティション + インデックスで最高性能

---

## 4. 外部キー範囲検索（1000著者）

| 構成 | 時間 | ベースライン比 |
|------|------|---------------|
| インデックスなし・パーティションなし | **2.46秒** | baseline |
| **インデックスあり**・パーティションなし | **5.4ms** | 99.8% 高速 |
| インデックスなし・**パーティションあり** | **1.6ms** | **99.9% 高速** |
| **インデックス + パーティション** | **0.3ms** | **99.99% 高速** |

### 分析
- 範囲検索ではパーティションが効果的
- インデックス + パーティションで0.3ms（最速）

---

## 5. Full Table COUNT

| 構成 | 時間 |
|------|------|
| インデックスなし・パーティションなし | **656ms** (最速) |
| インデックスあり・パーティションなし | 6.8秒 |
| インデックスなし・パーティションあり | 6.3秒 |
| インデックス + パーティション | 10.6秒 (最遅) |

### 分析
- COUNT(*) はインデックスもパーティションも逆効果
- シンプルなテーブルが最速

---

## 結論

### インデックスが最重要
- ほとんどのクエリで **99%以上の高速化**
- パーティションなしでも十分な効果

### パーティションの追加効果
- インデックス + パーティションで最高性能
- 特に範囲検索で効果大

### 注意点
- COUNT(*) は遅くなる
- パーティション分割のオーバーヘッドあり
